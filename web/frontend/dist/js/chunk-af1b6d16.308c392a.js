(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-af1b6d16"],{"10db":function(t,e,o){},"4d62":function(t,e,o){"use strict";var r=o("10db"),n=o.n(r);n.a},6737:function(t,e,o){"use strict";o.r(e);var r=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("Layout",{staticStyle:{height:"100%",width:"80%",margin:"0 auto"}},[o("Header",{staticStyle:{background:"transparent",padding:"0"}},[o("Button",{attrs:{size:"large",shape:"circle",type:"default",icon:"md-arrow-round-back"},on:{click:function(e){return t.$router.replace("/center/workflow")}}}),t._v(" \n    "),o("Button",{attrs:{size:"large",shape:"circle",type:"primary"},on:{click:function(e){return t.submit()}}},[t._v("提交")])],1),o("Layout",{staticStyle:{height:"100%",background:"#fff",padding:"50px 50px 0 50px"}},[o("Form",{attrs:{"label-position":"left","label-width":100,rules:t.rulesValidate,model:t.form}},[o("FormItem",{attrs:{label:"工作流名称",prop:"workflowName"}},[o("Row",[o("Col",{attrs:{span:"12"}},[o("Input",{model:{value:t.form.workflowName,callback:function(e){t.$set(t.form,"workflowName",e)},expression:"form.workflowName"}})],1)],1)],1),o("FormItem",{attrs:{label:"URI",prop:"workflowURI"}},[o("Row",[o("Col",{attrs:{span:"20"}},[o("Input",{model:{value:t.form.workflowURI,callback:function(e){t.$set(t.form,"workflowURI",e)},expression:"form.workflowURI"}})],1)],1)],1),o("FormItem",{attrs:{label:"可选函数列表"}},[o("Row",[o("Col",{attrs:{span:"12"}},[o("input",{staticStyle:{position:"absolute",left:"-999em"},attrs:{id:"dummy-uri"}}),o("ul",{staticStyle:{"list-style":"none","max-height":"100px","overflow-y":"scroll"}},t._l(t.functionList,function(e,r){return o("li",{key:r,staticStyle:{"border-top":"solid 1px lightgrey"},style:r===t.functionLastOne?"border-bottom: solid 1px lightgrey":""},[t._v("\n                "+t._s(e.name)+" (URI: "+t._s(e.uri)+")\n                "),o("Tooltip",{attrs:{content:"copy: "+e.uri,placement:"top"}},[o("Icon",{staticStyle:{color:"blue",cursor:"pointer"},attrs:{size:"16",type:"ios-copy-outline"},on:{click:function(o){return t.copyToClipboard(e.uri)}}})],1)],1)}),0)])],1)],1),o("FormItem",{attrs:{label:"工作流定义(JSON有限状态机)",prop:"definition"}},[o("Row",[o("Col",{attrs:{span:"14"}},[o("AceEditor",{ref:"workflowEditor",staticStyle:{"font-size":"0.9em"},attrs:{lang:"json",theme:"chrome",value:"",width:"100%",height:"420px"},on:{init:t.aceInit},model:{value:t.form.definition,callback:function(e){t.$set(t.form,"definition",e)},expression:"form.definition"}})],1),o("Col",{attrs:{span:"10"}},[o("svg",{staticStyle:{width:"100%",height:"420px"},attrs:{id:"workflow-preview"}},[o("g")])])],1)],1),o("FormItem",{attrs:{label:"最大闲置时间(Minute)",prop:"maxIdleTime"}},[o("Row",[o("Col",{attrs:{span:"6"}},[o("Input",{attrs:{type:"number"},model:{value:t.form.maxIdleTime,callback:function(e){t.$set(t.form,"maxIdleTime",t._n(e))},expression:"form.maxIdleTime"}})],1)],1)],1),o("FormItem",{attrs:{label:"立即部署"}},[o("i-switch",[o("span",{attrs:{slot:"open"},slot:"open"},[t._v("是")]),o("span",{attrs:{slot:"close"},slot:"close"},[t._v("否")])])],1)],1)],1)],1)},n=[],i=(o("ac6a"),o("456d"),o("2b0e")),a=o("5698"),s=o("1c46"),l={name:"WorkflowCreate",components:{AceEditor:o("7c9e")},data:function(){return{form:{workflowName:"",workflowURI:"",definition:"",maxIdleTime:60},functionList:[],rulesValidate:{workflowName:[{type:"string",required:!0,message:"工作流名称不能为空"}],workflowURI:[{type:"string",required:!0,pattern:/^[A-Za-z0-9-]+$/},{validator:function(t,e,o){i["default"].axios.post("/workflow/validate",{uri:e}).then(function(t){"success"===t.data.status?o():o(new Error(t.data.info))}).catch(function(t){o(new Error(t))})},trigger:"blur"}],definition:[{type:"string",required:!0}],maxIdleTime:[{type:"number",required:!0}]}}},mounted:function(){var t=this;this.axios.get("/function").then(function(e){if(200!==e.status)throw new Error(e.status+e.statusText);if("success"!==e.data.status)throw new Error(e.data.info);t.functionList=e.data.data}).catch(function(t){console.error(t)})},methods:{aceInit:function(){o("2099"),o("818b"),o("95b8");var t=this.$refs.workflowEditor.editor;t.on("blur",this.updatePreview)},submit:function(){var t=this;this.axios.post("/workflow/create",{name:this.form.workflowName,uri:this.form.workflowURI,definition:this.form.definition,max_idle_time:this.form.maxIdleTime}).then(function(e){if(200!==e.status)throw new Error(e.status+e.statusText);if("success"!==e.data.status)throw new Error(e.data.info);t.$Message.success("创建成功"),t.$router.push("/center/workflow")}).catch(function(e){t.$Message.error(e.message)})},updatePreview:function(){console.log("update");try{var t=a["c"]("#workflow-preview"),e=t.select("g"),o=new s["c"](t,e),r=new s["a"](JSON.parse(this.form.definition)),n=r.toDAG();o.clear(),o.setNodes(n.nodes),o.setEdges(n.edges),o.setStartNodes(n.startNodes),o.setEndNodes(n.endNodes),o.setParents(n.parents),o.redraw()}catch(i){console.log(i)}},copyToClipboard:function(t){console.log(t);var e=document.querySelector("#dummy-uri");e.value=t,e.select(),document.execCommand("copy")}},computed:{functionLastOne:function(){return Object.keys(this.functionList).length-1}}},c=l,u=(o("4d62"),o("2877")),f=Object(u["a"])(c,r,n,!1,null,null,null);e["default"]=f.exports}}]);
//# sourceMappingURL=chunk-af1b6d16.308c392a.js.map